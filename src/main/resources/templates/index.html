<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Boutique de Thés • Produits</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>

<!-- Sprite SVG -->
<svg xmlns="http://www.w3.org/2000/svg" style="display:none">
    <symbol id="i-plus" viewBox="0 0 24 24">
        <path fill="currentColor" d="M12 5a1 1 0 0 1 1 1v5h5a1 1 0 1 1 0 2h-5v5a1 1 0 1 1-2 0v-5H6a1 1 0 1 1 0-2h5V6a1 1 0 0 1 1-1z"/>
    </symbol>
    <symbol id="i-search" viewBox="0 0 24 24">
        <path fill="currentColor" d="M10 4a6 6 0 1 1 3.87 10.58l4.27 4.27a1 1 0 0 1-1.41 1.41l-4.27-4.27A6 6 0 0 1 10 4zm0 2a4 4 0 1 0 0 8a4 4 0 0 0 0-8z"/>
    </symbol>
    <symbol id="i-refresh" viewBox="0 0 24 24">
        <path fill="currentColor" d="M6.7 6.7A7 7 0 0 1 19 10a1 1 0 1 1-2 0a5 5 0 0 0-8.54-3.54l.83.83A1 1 0 0 1 8.6 9H5a1 1 0 0 1-1-1V4.4a1 1 0 0 1 1.71-.7l.99 1zM18 15a1 1 0 0 1 1 1v3.6a1 1 0 0 1-1.71.7l-.99-1A7 7 0 0 1 5 14a1 1 0 1 1 2 0a5 5 0 0 0 8.54 3.54l-.83-.83A1 1 0 0 1 15.4 15H18z"/>
    </symbol>
    <symbol id="i-download" viewBox="0 0 24 24">
        <path fill="currentColor" d="M12 3a1 1 0 0 1 1 1v9.59l2.3-2.3a1 1 0 1 1 1.4 1.42l-4.01 4a1 1 0 0 1-1.38 0l-4.01-4a1 1 0 1 1 1.4-1.42l2.3 2.3V4a1 1 0 0 1 1-1zM5 19a1 1 0 0 1 1-1h12a1 1 0 1 1 0 2H6a1 1 0 0 1-1-1z"/>
    </symbol>
    <symbol id="i-edit" viewBox="0 0 24 24">
        <path fill="currentColor" d="M4 17.25V20a1 1 0 0 0 1 1h2.75a1 1 0 0 0 .71-.29l9.9-9.9a1 1 0 0 0 0-1.42l-2.75-2.75a1 1 0 0 0-1.42 0l-9.9 9.9a1 1 0 0 0-.29.71zM14.5 6.5l3 3"/>
    </symbol>
    <symbol id="i-trash" viewBox="0 0 24 24">
        <path fill="currentColor" d="M9 3a1 1 0 0 0-1 1v1H5a1 1 0 1 0 0 2h1v13a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V7h1a1 1 0 1 0 0-2h-3V4a1 1 0 0 0-1-1H9zm1 2h4v0H10zm-2 2h8v13H8V7z"/>
    </symbol>
    <symbol id="i-arrow-left" viewBox="0 0 24 24">
        <path fill="currentColor" d="M14.7 6.3a1 1 0 0 1 0 1.4L11.41 11H20a1 1 0 1 1 0 2h-8.59l3.3 3.3a1 1 0 1 1-1.42 1.4l-5-5a1 1 0 0 1 0-1.4l5-5a1 1 0 0 1 1.42 0z"/>
    </symbol>
    <symbol id="i-arrow-right" viewBox="0 0 24 24">
        <path fill="currentColor" d="M9.3 17.7a1 1 0 0 1 0-1.4L12.59 13H4a1 1 0 1 1 0-2h8.59l-3.3-3.3a1 1 0 1 1 1.42-1.4l5 5a1 1 0 0 1 0 1.4l-5 5a1 1 0 0 1-1.42 0z"/>
    </symbol>
</svg>

<div class="container">

    <div class="appbar">
        <div class="brand">
            <div class="logo">T</div>
            <div>
                <h1>Boutique de Thés</h1>
                <p>Gestion du catalogue • recherche • tri • export CSV</p>
            </div>
        </div>

        <a class="btn btn-primary" th:href="@{/nouveau}">
            <svg class="icon"><use href="#i-plus"></use></svg>
            Ajouter
        </a>
    </div>

    <div class="card">
        <div class="card-header">
            <div class="card-title">
                <div>
                    <h2>Produits</h2>
                    <div class="meta" th:text="${totalItems} + ' produit(s)'"></div>
                </div>

                <a class="btn" th:href="@{/export/csv(q=${q}, type=${type}, sort=${sort}, dir=${dir})}">
                    <svg class="icon"><use href="#i-download"></use></svg>
                    Export CSV
                </a>
            </div>
        </div>

        <div class="card-body">
            <div class="toolbar">
                <form class="filters" th:action="@{/}" method="get">
                    <input class="input" id="q" type="text" name="q"
                           placeholder="Rechercher par nom…"
                           th:value="${q}" />

                    <select class="select" id="type" name="type">
                        <option value="" th:selected="${type == ''}">Tous les types</option>
                        <option th:each="t : ${types}" th:value="${t}" th:text="${t}" th:selected="${t == type}"></option>
                    </select>

                    <input type="hidden" name="sort" th:value="${sort}" />
                    <input type="hidden" name="dir" th:value="${dir}" />

                    <button class="btn" type="submit">
                        <svg class="icon"><use href="#i-search"></use></svg>
                        Filtrer
                    </button>

                    <a class="btn" th:href="@{/(q='', type='', page=0, size=10, sort='nom', dir='asc')}">
                        <svg class="icon"><use href="#i-refresh"></use></svg>
                        Réinitialiser
                    </a>
                </form>
            </div>

            <div class="table-wrap">
                <table>
                    <thead>
                    <tr>
                        <th style="width:70px;">ID</th>

                        <th>
                            <a class="sort"
                               th:href="@{/(q=${q}, type=${type}, page=${currentPage}, size=10, sort='nom', dir=${sort=='nom' ? nextDir : 'asc'})}">
                                Nom <span class="arrow" th:if="${sort=='nom'}" th:text="${dir=='asc' ? '▲' : '▼'}"></span>
                            </a>
                        </th>

                        <th style="width:130px;">Type</th>
                        <th style="width:140px;">Origine</th>

                        <th style="width:130px;">
                            <a class="sort"
                               th:href="@{/(q=${q}, type=${type}, page=${currentPage}, size=10, sort='prix', dir=${sort=='prix' ? nextDir : 'asc'})}">
                                Prix <span class="arrow" th:if="${sort=='prix'}" th:text="${dir=='asc' ? '▲' : '▼'}"></span>
                            </a>
                        </th>

                        <th style="width:150px;">
                            <a class="sort"
                               th:href="@{/(q=${q}, type=${type}, page=${currentPage}, size=10, sort='quantiteStock', dir=${sort=='quantiteStock' ? nextDir : 'asc'})}">
                                Stock <span class="arrow" th:if="${sort=='quantiteStock'}" th:text="${dir=='asc' ? '▲' : '▼'}"></span>
                            </a>
                        </th>

                        <th style="width:150px;">Réception</th>
                        <th>Description</th>
                        <th style="width:220px; text-align:right;">Actions</th>
                    </tr>
                    </thead>

                    <tbody>
                    <tr th:each="p : ${produits}">
                        <td th:text="${p.id}"></td>

                        <td>
                            <div style="font-weight:700;" th:text="${p.nom}"></div>
                            <div class="cell-muted" th:text="${p.typeThe}"></div>
                        </td>

                        <td><span class="badge" th:text="${p.typeThe}"></span></td>
                        <td th:text="${p.origine}"></td>
                        <td th:text="${#numbers.formatDecimal(p.prix, 1, 2)} + ' €'"></td>

                        <td>
              <span th:class="${p.quantiteStock == 0} ? 'badge out' : (${p.quantiteStock < 10} ? 'badge low' : 'badge ok')"
                    th:text="${p.quantiteStock == 0} ? 'Rupture' : (${p.quantiteStock < 10} ? 'Faible • ' + ${p.quantiteStock} : 'OK • ' + ${p.quantiteStock})">
              </span>
                        </td>

                        <td th:text="${p.dateReception}"></td>
                        <td class="description-clamp" th:text="${p.description}"></td>

                        <td>
                            <div class="actions">
                                <a class="btn" th:href="@{/modifier/{id}(id=${p.id})}">
                                    <svg class="icon"><use href="#i-edit"></use></svg>
                                    Modifier
                                </a>
                                <a class="btn btn-danger"
                                   th:href="@{/supprimer/{id}(id=${p.id})}"
                                   onclick="return confirm('Confirmer la suppression ?');">
                                    <svg class="icon"><use href="#i-trash"></use></svg>
                                    Supprimer
                                </a>
                            </div>
                        </td>
                    </tr>

                    <tr th:if="${#lists.isEmpty(produits)}">
                        <td colspan="9" style="text-align:center; padding: 24px;">
                            Aucun produit trouvé.
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <div class="pagination" th:if="${totalPages > 1}">
                <div class="pager">
                    <a class="btn" th:if="${currentPage > 0}"
                       th:href="@{/(q=${q}, type=${type}, page=${(currentPage - 1)}, size=10, sort=${sort}, dir=${dir})}">
                        <svg class="icon"><use href="#i-arrow-left"></use></svg>
                        Précédent
                    </a>

                    <span class="pageinfo" th:text="'Page ' + ${currentPage + 1} + ' / ' + ${totalPages}"></span>

                    <a class="btn" th:if="${currentPage < (totalPages - 1)}"
                       th:href="@{/(q=${q}, type=${type}, page=${(currentPage + 1)}, size=10, sort=${sort}, dir=${dir})}">
                        Suivant
                        <svg class="icon"><use href="#i-arrow-right"></use></svg>
                    </a>
                </div>

                <div class="pageinfo" th:text="${totalItems} + ' élément(s)'"></div>
            </div>

        </div>
    </div>

    <div class="footer-note">
        © 2026 • Sup de Vinci • Spring Boot / JPA / MySQL
    </div>

</div>
</body>
</html>
